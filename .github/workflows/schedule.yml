# .github/workflows/schedule.yml

name: Run Scraper Daily

on:
  workflow_dispatch: # GitHub Actions íƒ­ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•¨ (í…ŒìŠ¤íŠ¸ìš©)
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ(KST)ì— ì‹¤í–‰ (UTC ê¸°ì¤€ ìì •ì— í•´ë‹¹)
    - cron: '50 10 * * *'

permissions:
  contents: write

jobs:
  scrape:
    runs-on: ubuntu-latest # ê°€ìƒ ì»´í“¨í„°ëŠ” ìš°ë¶„íˆ¬(ë¦¬ëˆ…ìŠ¤) í™˜ê²½

    steps:
      # 1. ë‚´ ì½”ë“œë¥¼ ê°€ìƒ ì»´í“¨í„°ë¡œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •í•˜ê¸°
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # ìš°ë¦¬ê°€ ì‚¬ìš©í•œ íŒŒì´ì¬ ë²„ì „

      # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•˜ê¸°
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          # Seleniumì´ headless í¬ë¡¬ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë“œë¼ì´ë²„ ì„¤ì¹˜
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      # 4. íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰í•˜ê¸°
      - name: Run Python script
        run: python main.py

      # 5. ë³€ê²½ëœ stats.csv íŒŒì¼ì„ ë‹¤ì‹œ GitHubì— ì €ì¥í•˜ê¸° (ê°€ì¥ ì¤‘ìš”!)
      - name: Commit and push if it changed
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add stats.csv
          # ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹
          git diff --staged --quiet || git commit -m "ğŸ“Š Update stats.csv"
          git push
